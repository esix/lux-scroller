<!DOCTYPE html>
<html>
<head>
  <title>lux-scroll demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
  <style>
    body {
      background-color: #cccccc;
      text-align: center;
      padding-top: 50px;  
    }

    #canvas {
      background-color: white;
    }
  </style>
</head>
<body>

  <canvas id="canvas" width="490" height="490" ></canvas>

  <script>
    require(['../dist/index'], function (scroller) {
      var canvas = document.getElementById('canvas');

      var scrollController = new scroller.ScrollController({
        containerWidth: canvas.width,
        containerHeight: canvas.height,
        contentWidth: 2500,
        contentHeight: 2500,
      });

      // install events
      canvas.addEventListener('mousedown', function (event) {
        scrollController.onTouchStart(event.offsetX, event.offsetY);
      });
      canvas.addEventListener('mouseout', function (event) {
        scrollController.onTouchEnd(event.offsetX, event.offsetY);
      });
      canvas.addEventListener('wheel', function (event) {
        if (event.deltaY > 0) {
          scrollController.onZoomIn(event.deltaY, event.offsetX, event.offsetY);
        } else if (event.deltaY < 0) {
          scrollController.onZoomOut(-event.deltaY, event.offsetX, event.offsetY);
        }
      });
      canvas.addEventListener('mousemove', function (event) {
        if (event.buttons && 1) {
          scrollController.onTouchMove(event.offsetX, event.offsetY);
        } else {
          scrollController.onTouchEnd(event.offsetX, event.offsetY);
        }
      });


      // render squares
      var ctx = canvas.getContext('2d');

      function renderSquare(j, i, x, y, zoomX, zoomY, isFirst, isLast) {
        ctx.lineWidth = 1;
        var width = 100 * zoomX;
        var height = 100 * zoomY;

        ctx.beginPath();
        ctx.moveTo(x + width - 2, y);
        ctx.lineTo(x, y);
        ctx.lineTo(x, y + height - 2);
        ctx.strokeStyle = '#cccccc';
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(x + width / 10, y);
        ctx.lineTo(x, y);
        ctx.lineTo(x, y + height / 10);
        ctx.strokeStyle = (isFirst || isLast) ? '#ff0000' : '#000000';
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(x + width * 0.9, y + height - 1);
        ctx.lineTo(x + width - 1, y + height - 1);
        ctx.lineTo(x + width - 1, y + height * 0.9);
        ctx.strokeStyle = (isFirst || isLast) ? '#ff0000' : '#000000';
        ctx.stroke();

        ctx.font = "10px Arial";
        ctx.textAlign = 'left';
        ctx.textBaseline = 'hanging';
        ctx.strokeStyle = '#000000';
        ctx.strokeText('(' + j + ', ' + i + ')', x + 10, y + 10);
      }

      function redraw(pos) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        var zoomX = pos.zoomX;
        var zoomY = pos.zoomY;
        var width = 100 * zoomX;
        var height = 100 * zoomY;

        // find squares to draw:        
        var iMin = Math.max(0, Math.floor(pos.top / width));                    // min visible y-index
        var iMax = Math.min(25, Math.ceil((pos.top + pos.height) / width));     // max visible y-index (first invisible)
        var jMin = Math.max(0, Math.floor(pos.left / height));                  // min visible x-index
        var jMax = Math.min(25, Math.ceil((pos.left + pos.width) / height));    // max visible x-index (first invisible)

        for(var i = iMin; i < iMax; i++) {
          for(var j = jMin; j < jMax; j++) {
            var y = i * width - pos.top;
            var x = j * height - pos.left;
            var isFirst = (i === iMin && j === jMin);
            var isLast = (i === iMax - 1 && j === jMax - 1);
            renderSquare(j, i, x, y, zoomX, zoomY, isFirst, isLast);
          }
        }
      }

      // update position
      var prevPos = null;
      window.setInterval(function() {
        var pos = scrollController.getPosition();

        if (prevPos !== pos) {
          prevPos = pos;
          redraw(pos);
        }
      }, 55);


    });
  </script>
</body>
</html>